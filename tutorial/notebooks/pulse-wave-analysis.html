
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pulse Wave Analysis &#8212; MIMIC WFDB Tutorials</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script >const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Extracting BP values" href="extracting-reference-bp.html" />
    <link rel="prev" title="Beat detection" href="beat-detection.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/icon.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">MIMIC WFDB Tutorials</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Overview
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../workshop.html">
   Workshop
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../workshop/workshop-aims.html">
     Workshop Aims
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../workshop/workshop-synopsis.html">
     Workshop Synopsis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../workshop/workshop-schedule.html">
     Workshop Schedule
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../workshop/workshop-prep.html">
     Workshop Preparation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../mimic-database.html">
   MIMIC Database
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../mimic/physionet.html">
     PhysioNet
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../mimic/context.html">
     Clinical Context
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../mimic/structure.html">
     Database Structure
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../mimic/formatting.html">
     Waveform Data Formats
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../mimic/wfdb-toolbox.html">
     WFDB Toolbox
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../tutorials.html">
   Tutorials
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="data-exploration.html">
     Data Exploration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="data-extraction.html">
     Data Extraction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="data-visualisation.html">
     Data Visualisation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="identifying-suitable-data.html">
     Identifying suitable data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="signal-filtering.html">
     Filtering Signals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="differentiation.html">
     Differentiating the PPG signal
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="beat-detection.html">
     Beat detection
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Pulse Wave Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="extracting-reference-bp.html">
     Extracting BP values
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-modelling.html">
     Data modelling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-analysis.html">
     Data analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data-interpretation.html">
     Data interpretation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../case-study.html">
   Case Study
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../additional-resources.html">
   Additional Resources
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../about.html">
   About this Book
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../about/about-contributing.html">
     How to Contribute
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../about/about-maintenance.html">
     Maintenance
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../tutorials-for-the-future.html">
   Future Tutorials
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="qrs-detection.html">
     QRS peak detection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../signal-quality-assessment.html">
     Signal Quality Assessment
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/wfdb/mimic_wfdb_tutorials/main?urlpath=tree/content/tutorial/notebooks/pulse-wave-analysis.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/wfdb/mimic_wfdb_tutorials/blob/main/content/tutorial/notebooks/pulse-wave-analysis.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/wfdb/mimic_wfdb_tutorials"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/wfdb/mimic_wfdb_tutorials/issues/new?title=Issue%20on%20page%20%2Ftutorial/notebooks/pulse-wave-analysis.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/wfdb/mimic_wfdb_tutorials/edit/main/content/tutorial/notebooks/pulse-wave-analysis.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/tutorial/notebooks/pulse-wave-analysis.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#extract-data">
   Extract data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#filter-the-ppg-signal">
   Filter the PPG signal
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#beat-detection">
   Beat Detection
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#identify-fiducial-points-on-pulse-waves">
   Identify fiducial points on pulse waves
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#calculate-pulse-wave-features">
   Calculate pulse wave features
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Pulse Wave Analysis</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#extract-data">
   Extract data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#filter-the-ppg-signal">
   Filter the PPG signal
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#beat-detection">
   Beat Detection
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#identify-fiducial-points-on-pulse-waves">
   Identify fiducial points on pulse waves
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#calculate-pulse-wave-features">
   Calculate pulse wave features
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="section" id="pulse-wave-analysis">
<h1>Pulse Wave Analysis<a class="headerlink" href="#pulse-wave-analysis" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial we will learn how to extract features from PPG pulse waves.</p>
<p>The <strong>objectives</strong> are:</p>
<ul class="simple">
<li><p>To use a function to detect several fiducial points on PPG pulse waves</p></li>
<li><p>To calculate pulse wave features from the fiducial points</p></li>
</ul>
<div class="alert alert-block alert-warning"> <b>Context:</b> One approach to estimating BP from PPG signals consists of extracting features from PPG pulse waves, and then using these as inputs to BP estimation model. This tutorial covers the first of these steps: extracting features from PPG pulse waves.</div><div class="alert alert-block alert-info"> <b>Resource:</b> You can read more about pulse wave analysis in Sections 3.2.2 and 3.2.3 of <a href="https://peterhcharlton.github.io/publication/ppg_sig_proc_chapter/">this book</a>.</div><hr class="docutils" />
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Specify the required Python packages</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="k">as</span> <span class="nn">sp</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="kn">import</span> <span class="nn">wfdb</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Specify the settings for the MIMIC-III database</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wfdb</span><span class="o">.</span><span class="n">set_db_index_url</span><span class="p">(</span><span class="s1">&#39;https://physionet.org/files&#39;</span><span class="p">)</span> <span class="c1"># use the version of the WFDB toolbox which corresponds to MIMIC IV.</span>
<span class="n">database_name</span> <span class="o">=</span> <span class="s1">&#39;mimic3wdb/1.0&#39;</span> <span class="c1"># The name of the MIMIC III Waveform Database on Physionet (see URL: https://physionet.org/content/mimic3wdb/1.0/)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Provide a list of segments which meet the requirements for the study</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">segment_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;3000063_0013&#39;</span><span class="p">]</span>
<span class="n">segment_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mimic3wdb/1.0/30/3000063/&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Specify a segment from which to extract data</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rel_segment_no</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">rel_segment_name</span> <span class="o">=</span> <span class="n">segment_names</span><span class="p">[</span><span class="n">rel_segment_no</span><span class="p">]</span>
<span class="n">rel_segment_dir</span> <span class="o">=</span> <span class="n">segment_dirs</span><span class="p">[</span><span class="n">rel_segment_no</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Specified segment &#39;</span><span class="si">{}</span><span class="s2">&#39; in directory &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rel_segment_name</span><span class="p">,</span> <span class="n">rel_segment_dir</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Specified segment &#39;3000063_0013&#39; in directory &#39;mimic3wdb/1.0/30/3000063/&#39;
</pre></div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="extract-data">
<h2>Extract data<a class="headerlink" href="#extract-data" title="Permalink to this headline">¶</a></h2>
<p>Extract data from this segment</p>
<ul class="simple">
<li><p>Specify the duration to be extracted</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start_time</span> <span class="o">=</span> <span class="mi">60</span> <span class="c1"># time since the start of the segment at which to begin extracting data</span>
<span class="n">no_seconds_to_load</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Find out the sampling frequency of the waveform data</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">segment_metadata</span> <span class="o">=</span> <span class="n">wfdb</span><span class="o">.</span><span class="n">rdheader</span><span class="p">(</span><span class="n">record_name</span><span class="o">=</span><span class="n">rel_segment_name</span><span class="p">,</span> <span class="n">pn_dir</span><span class="o">=</span><span class="n">rel_segment_dir</span><span class="p">)</span>
<span class="n">fs</span> <span class="o">=</span> <span class="n">segment_metadata</span><span class="o">.</span><span class="n">fs</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sampling frequency is </span><span class="si">{}</span><span class="s2"> Hz&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fs</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sampling frequency is 125 Hz
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Extract this duration of signals from the longer segment</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">segment_data</span> <span class="o">=</span> <span class="n">wfdb</span><span class="o">.</span><span class="n">rdrecord</span><span class="p">(</span><span class="n">record_name</span> <span class="o">=</span> <span class="n">rel_segment_name</span><span class="p">,</span> <span class="n">sampfrom</span> <span class="o">=</span> <span class="n">fs</span><span class="o">*</span><span class="n">start_time</span><span class="p">,</span> <span class="n">sampto</span> <span class="o">=</span> <span class="n">fs</span><span class="o">*</span><span class="p">(</span><span class="n">start_time</span> <span class="o">+</span> <span class="n">no_seconds_to_load</span><span class="p">),</span> <span class="n">pn_dir</span> <span class="o">=</span> <span class="n">rel_segment_dir</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> seconds of data loaded from segment &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">no_seconds_to_load</span><span class="p">,</span> <span class="n">rel_segment_name</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10 seconds of data loaded from segment &#39;3000063_0013&#39;
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Extract the PPG signal</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">abp_col</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">sig_no</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">segment_data</span><span class="o">.</span><span class="n">sig_name</span><span class="p">)):</span>
    <span class="k">if</span> <span class="s2">&quot;PLETH&quot;</span> <span class="ow">in</span> <span class="n">segment_data</span><span class="o">.</span><span class="n">sig_name</span><span class="p">[</span><span class="n">sig_no</span><span class="p">]:</span>
        <span class="n">ppg_col</span> <span class="o">=</span> <span class="n">sig_no</span>
<span class="n">ppg</span> <span class="o">=</span> <span class="n">segment_data</span><span class="o">.</span><span class="n">p_signal</span><span class="p">[:,</span><span class="n">ppg_col</span><span class="p">]</span>
<span class="n">fs</span> <span class="o">=</span> <span class="n">segment_data</span><span class="o">.</span><span class="n">fs</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Extracted the PPG signal from column </span><span class="si">{}</span><span class="s2"> of the matrix of waveform data.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ppg_col</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sampled at </span><span class="si">{}</span><span class="s2"> Hz.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">segment_data</span><span class="o">.</span><span class="n">fs</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Extracted the PPG signal from column 2 of the matrix of waveform data.
Sampled at 125 Hz.
</pre></div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="filter-the-ppg-signal">
<h2>Filter the PPG signal<a class="headerlink" href="#filter-the-ppg-signal" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="n">sos_filter</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">btype</span> <span class="o">=</span> <span class="s1">&#39;bp&#39;</span><span class="p">,</span> <span class="n">analog</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;sos&#39;</span><span class="p">,</span> <span class="n">fs</span> <span class="o">=</span> <span class="n">segment_data</span><span class="o">.</span><span class="n">fs</span><span class="p">)</span>
<span class="n">ppg_filt</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">sosfiltfilt</span><span class="p">(</span><span class="n">sos_filter</span><span class="p">,</span> <span class="n">ppg</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="beat-detection">
<h2>Beat Detection<a class="headerlink" href="#beat-detection" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">run</span> beat_detection_functions
<span class="n">ibis</span> <span class="o">=</span> <span class="n">pulse_detect</span><span class="p">(</span><span class="n">ppg_filt</span><span class="p">,</span><span class="n">fs</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;d2max&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Detected </span><span class="si">{}</span><span class="s2"> beats in the PPG signal using the </span><span class="si">{}</span><span class="s2"> algorithm&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ibis</span><span class="p">),</span> <span class="s2">&quot;D2max&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Detected 17 beats in the PPG signal using the D2max algorithm
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<hr class="docutils" />
<p><strong>… Pete to continue from here …</strong></p>
<hr class="docutils" />
</div>
<hr class="docutils" />
<div class="section" id="identify-fiducial-points-on-pulse-waves">
<h2>Identify fiducial points on pulse waves<a class="headerlink" href="#identify-fiducial-points-on-pulse-waves" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Define the required functions</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fiducial_points</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">pks</span><span class="p">,</span><span class="n">fs</span><span class="p">,</span><span class="n">vis</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Description: Pulse detection and correction from pulsatile signals</span>
<span class="sd">    Inputs:  x, array with pulsatile signal [user defined units]</span>
<span class="sd">             pks, array with the position of the peaks [number of samples]</span>
<span class="sd">             fs, sampling rate of signal [Hz]</span>
<span class="sd">             vis, visualisation option [True, False]</span>
<span class="sd">    Outputs: fidp, dictionary with the positions of several fiducial points for the cardiac cycles [number of samples]</span>
<span class="sd">    </span>
<span class="sd">    Fiducial points:  1: Systolic peak (pks)</span>
<span class="sd">                      2: Onset, as the minimum before the systolic peak (ons)</span>
<span class="sd">                      3: Onset, using the tangent intersection method (ti) </span>
<span class="sd">                      4: Diastolic peak (dpk)</span>
<span class="sd">                      5: Maximum slope (m1d)</span>
<span class="sd">                      6: a point from second derivative PPG (a2d)</span>
<span class="sd">                      7: b point from second derivative PPG (b2d)</span>
<span class="sd">                      8: c point from second derivative PPG (c2d)</span>
<span class="sd">                      9: d point from second derivative PPG (d2d)</span>
<span class="sd">                      10: e point from second derivative PPG (e2d)</span>
<span class="sd">                      11: p1 from the third derivative PPG (p1)    </span>
<span class="sd">                      12: p2 from the third derivative PPG (p2)</span>
<span class="sd">    </span>
<span class="sd">    Libraries: NumPy (as np), SciPy (Signal, as sp), Matplotlib (PyPlot, as plt)</span>
<span class="sd">    </span>
<span class="sd">    Version: 1.0 - June 2022</span>
<span class="sd">    </span>
<span class="sd">    Developed by: Elisa Mejía-Mejía</span>
<span class="sd">                   City, University of London</span>
<span class="sd">    </span>
<span class="sd">    Edited by: Peter Charlton (see &quot;Added by PC&quot;)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="c1"># First, second and third derivatives</span>
    <span class="n">d1x</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">savgol_filter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">deriv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> 
    <span class="n">d2x</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">savgol_filter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">deriv</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> 
    <span class="n">d3x</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">savgol_filter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">deriv</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> 
    
    <span class="c1">#plt.figure()</span>
    <span class="c1">#plt.plot(x/np.max(x))</span>
    <span class="c1">#plt.plot(d1x/np.max(d1x))</span>
    <span class="c1">#plt.plot(d2x/np.max(d2x))</span>
    <span class="c1">#plt.plot(d3x/np.max(d3x))</span>
    
    <span class="c1"># Search in time series: Onsets between consecutive peaks</span>
    <span class="n">ons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pks</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">pks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">pks</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">ibi</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="c1">#plt.figure()</span>
        <span class="c1">#plt.plot(ibi, color = &#39;black&#39;)</span>
        <span class="n">aux_ons</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ibi</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ibi</span><span class="p">))</span>
        <span class="n">ind_ons</span> <span class="o">=</span> <span class="n">aux_ons</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">ons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ons</span><span class="p">,</span> <span class="n">ind_ons</span> <span class="o">+</span> <span class="n">start</span><span class="p">)</span>   
        <span class="c1">#plt.plot(ind_ons, ibi[ind_ons], marker = &#39;o&#39;, color = &#39;red&#39;) </span>
    <span class="n">ons</span> <span class="o">=</span> <span class="n">ons</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="c1">#print(&#39;Onsets: &#39; + str(ons))</span>
    <span class="c1">#plt.figure()</span>
    <span class="c1">#plt.plot(x, color = &#39;black&#39;)</span>
    <span class="c1">#plt.scatter(pks, x[pks], marker = &#39;o&#39;, color = &#39;red&#39;) </span>
    <span class="c1">#plt.scatter(ons, x[ons], marker = &#39;o&#39;, color = &#39;blue&#39;) </span>
    
    <span class="c1"># Search in time series: Diastolic peak and dicrotic notch between consecutive onsets</span>
    <span class="n">dia</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">dic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ons</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">ons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">ons</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">ind_pks</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pks</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pks</span> <span class="o">&gt;</span> <span class="n">start</span><span class="p">))</span>
        <span class="n">ind_pks</span> <span class="o">=</span> <span class="n">pks</span><span class="p">[</span><span class="n">ind_pks</span><span class="p">]</span>
        <span class="n">ibi_portion</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ind_pks</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="n">ibi_2d_portion</span> <span class="o">=</span> <span class="n">d2x</span><span class="p">[</span><span class="n">ind_pks</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="c1">#plt.figure()</span>
        <span class="c1">#plt.plot(ibi_portion/np.max(ibi_portion))</span>
        <span class="c1">#plt.plot(ibi_2d_portion/np.max(ibi_2d_portion))</span>
        <span class="n">aux_dic</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">ibi_2d_portion</span><span class="p">)</span>
        <span class="n">aux_dic</span> <span class="o">=</span> <span class="n">aux_dic</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">aux_dia</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="o">-</span><span class="n">ibi_2d_portion</span><span class="p">)</span>
        <span class="n">aux_dia</span> <span class="o">=</span> <span class="n">aux_dia</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>   
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aux_dic</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ind_max</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ibi_2d_portion</span><span class="p">[</span><span class="n">aux_dic</span><span class="p">]</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ibi_2d_portion</span><span class="p">[</span><span class="n">aux_dic</span><span class="p">]))</span>
            <span class="n">aux_dic_max</span> <span class="o">=</span> <span class="n">aux_dic</span><span class="p">[</span><span class="n">ind_max</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aux_dia</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">nearest</span> <span class="o">=</span> <span class="n">aux_dia</span> <span class="o">-</span> <span class="n">aux_dic_max</span>
                <span class="n">aux_dic</span> <span class="o">=</span> <span class="n">aux_dic_max</span>
                <span class="n">dic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> <span class="p">(</span><span class="n">aux_dic</span> <span class="o">+</span> <span class="n">ind_pks</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
                <span class="c1">#plt.scatter(aux_dic, ibi_portion[aux_dic]/np.max(ibi_portion), marker = &#39;o&#39;)</span>
                <span class="n">ind_dia</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">nearest</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">aux_dia</span> <span class="o">=</span> <span class="n">aux_dia</span><span class="p">[</span><span class="n">ind_dia</span><span class="p">]</span>
                <span class="n">nearest</span> <span class="o">=</span> <span class="n">nearest</span><span class="p">[</span><span class="n">ind_dia</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nearest</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">ind_nearest</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">nearest</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">nearest</span><span class="p">))</span>
                    <span class="n">aux_dia</span> <span class="o">=</span> <span class="n">aux_dia</span><span class="p">[</span><span class="n">ind_nearest</span><span class="p">]</span>
                    <span class="n">dia</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dia</span><span class="p">,</span> <span class="p">(</span><span class="n">aux_dia</span> <span class="o">+</span> <span class="n">ind_pks</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
                    <span class="c1">#plt.scatter(aux_dia, ibi_portion[aux_dia]/np.max(ibi_portion), marker = &#39;o&#39;)</span>
                    <span class="c1">#break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> <span class="p">(</span><span class="n">aux_dic_max</span> <span class="o">+</span> <span class="n">ind_pks</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
                <span class="c1">#plt.scatter(aux_dia, ibi_portion[aux_dia]/np.max(ibi_portion), marker = &#39;o&#39;)     </span>
    <span class="n">dia</span> <span class="o">=</span> <span class="n">dia</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">dic</span> <span class="o">=</span> <span class="n">dic</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="c1">#plt.scatter(dia, x[dia], marker = &#39;o&#39;, color = &#39;orange&#39;)</span>
    <span class="c1">#plt.scatter(dic, x[dic], marker = &#39;o&#39;, color = &#39;green&#39;)</span>
    
    <span class="c1"># Search in D1: Maximum slope point</span>
    <span class="n">m1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ons</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">ons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">ons</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">ind_pks</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pks</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pks</span> <span class="o">&gt;</span> <span class="n">start</span><span class="p">))</span>
        <span class="n">ind_pks</span> <span class="o">=</span> <span class="n">pks</span><span class="p">[</span><span class="n">ind_pks</span><span class="p">]</span>
        <span class="n">ibi_portion</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">ind_pks</span><span class="p">]</span>
        <span class="n">ibi_1d_portion</span> <span class="o">=</span> <span class="n">d1x</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">ind_pks</span><span class="p">]</span>
        <span class="c1">#plt.figure()</span>
        <span class="c1">#plt.plot(ibi_portion/np.max(ibi_portion))</span>
        <span class="c1">#plt.plot(ibi_1d_portion/np.max(ibi_1d_portion))</span>
        <span class="n">aux_m1d</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">ibi_1d_portion</span><span class="p">)</span>
        <span class="n">aux_m1d</span> <span class="o">=</span> <span class="n">aux_m1d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aux_m1d</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ind_max</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ibi_1d_portion</span><span class="p">[</span><span class="n">aux_m1d</span><span class="p">]</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ibi_1d_portion</span><span class="p">[</span><span class="n">aux_m1d</span><span class="p">]))</span>
            <span class="n">aux_m1d_max</span> <span class="o">=</span> <span class="n">aux_m1d</span><span class="p">[</span><span class="n">ind_max</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aux_m1d_max</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">aux_m1d_max</span> <span class="o">=</span> <span class="n">aux_m1d_max</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">m1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m1d</span><span class="p">,</span> <span class="p">(</span><span class="n">aux_m1d_max</span> <span class="o">+</span> <span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
            <span class="c1">#plt.scatter(aux_m1d, ibi_portion[aux_dic]/np.max(ibi_portion), marker = &#39;o&#39;)</span>
            <span class="c1">#break    </span>
    <span class="n">m1d</span> <span class="o">=</span> <span class="n">m1d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="c1">#plt.scatter(m1d, x[m1d], marker = &#39;o&#39;, color = &#39;purple&#39;)</span>
    
    <span class="c1"># Search in time series: Tangent intersection points</span>
    <span class="n">tip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ons</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">ons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">ons</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">ibi_portion</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="n">ibi_1d_portion</span> <span class="o">=</span> <span class="n">d1x</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="n">ind_m1d</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">m1d</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">m1d</span> <span class="o">&gt;</span> <span class="n">start</span><span class="p">))</span>
        <span class="n">ind_m1d</span> <span class="o">=</span> <span class="n">m1d</span><span class="p">[</span><span class="n">ind_m1d</span><span class="p">]</span> <span class="o">-</span> <span class="n">start</span>
        <span class="c1">#plt.figure()</span>
        <span class="c1">#plt.plot(ibi_portion/np.max(ibi_portion))</span>
        <span class="c1">#plt.plot(ibi_1d_portion/np.max(ibi_1d_portion))</span>
        <span class="c1">#plt.scatter(ind_m1d, ibi_portion[ind_m1d]/np.max(ibi_portion), marker = &#39;o&#39;)</span>
        <span class="c1">#plt.scatter(ind_m1d, ibi_1d_portion[ind_m1d]/np.max(ibi_1d_portion), marker = &#39;o&#39;)</span>
        <span class="n">aux_tip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(((</span><span class="n">ibi_portion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ibi_portion</span><span class="p">[</span><span class="n">ind_m1d</span><span class="p">])</span><span class="o">/</span><span class="n">ibi_1d_portion</span><span class="p">[</span><span class="n">ind_m1d</span><span class="p">])</span> <span class="o">+</span> <span class="n">ind_m1d</span><span class="p">)</span>
        <span class="n">aux_tip</span> <span class="o">=</span> <span class="n">aux_tip</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">tip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tip</span><span class="p">,</span> <span class="p">(</span><span class="n">aux_tip</span> <span class="o">+</span> <span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>        
        <span class="c1">#plt.scatter(aux_tip, ibi_portion[aux_tip]/np.max(ibi_portion), marker = &#39;o&#39;)</span>
        <span class="c1">#break</span>
    <span class="n">tip</span> <span class="o">=</span> <span class="n">tip</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="c1">#plt.scatter(tip, x[tip], marker = &#39;o&#39;, color = &#39;aqua&#39;)</span>
    
    <span class="c1"># Search in D2: A, B, C, D and E points</span>
    <span class="n">a2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">b2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">c2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">d2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">e2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ons</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">ons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">ons</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">ibi_portion</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="n">ibi_1d_portion</span> <span class="o">=</span> <span class="n">d1x</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="n">ibi_2d_portion</span> <span class="o">=</span> <span class="n">d2x</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="n">ind_m1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">m1d</span> <span class="o">&gt;</span> <span class="n">start</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">m1d</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">))</span>
        <span class="n">ind_m1d</span> <span class="o">=</span> <span class="n">m1d</span><span class="p">[</span><span class="n">ind_m1d</span><span class="p">]</span>
        <span class="c1">#plt.figure()</span>
        <span class="c1">#plt.plot(ibi_portion/np.max(ibi_portion))</span>
        <span class="c1">#plt.plot(ibi_1d_portion/np.max(ibi_1d_portion))</span>
        <span class="c1">#plt.plot(ibi_2d_portion/np.max(ibi_2d_portion))</span>
        <span class="n">aux_m2d_pks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">ibi_2d_portion</span><span class="p">)</span>
        <span class="n">aux_m2d_ons</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="o">-</span><span class="n">ibi_2d_portion</span><span class="p">)</span>
        <span class="c1"># a point:</span>
        <span class="n">ind_a</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ibi_2d_portion</span><span class="p">[</span><span class="n">aux_m2d_pks</span><span class="p">]</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ibi_2d_portion</span><span class="p">[</span><span class="n">aux_m2d_pks</span><span class="p">]))</span>
        <span class="n">ind_a</span> <span class="o">=</span> <span class="n">aux_m2d_pks</span><span class="p">[</span><span class="n">ind_a</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ind_a</span> <span class="o">&lt;</span> <span class="n">ind_m1d</span><span class="p">):</span>
            <span class="n">a2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a2d</span><span class="p">,</span> <span class="n">ind_a</span> <span class="o">+</span> <span class="n">start</span><span class="p">)</span>
            <span class="c1">#plt.scatter(ind_a, ibi_2d_portion[ind_a]/np.max(ibi_2d_portion), marker = &#39;o&#39;)</span>
            <span class="c1"># b point:</span>
            <span class="n">ind_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ibi_2d_portion</span><span class="p">[</span><span class="n">aux_m2d_ons</span><span class="p">]</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ibi_2d_portion</span><span class="p">[</span><span class="n">aux_m2d_ons</span><span class="p">]))</span>
            <span class="n">ind_b</span> <span class="o">=</span> <span class="n">aux_m2d_ons</span><span class="p">[</span><span class="n">ind_b</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ind_b</span> <span class="o">&gt;</span> <span class="n">ind_a</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ind_b</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">ibi_2d_portion</span><span class="p">)):</span>
                <span class="n">b2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b2d</span><span class="p">,</span> <span class="n">ind_b</span> <span class="o">+</span> <span class="n">start</span><span class="p">)</span>
                <span class="c1">#plt.scatter(ind_b, ibi_2d_portion[ind_b]/np.max(ibi_2d_portion), marker = &#39;o&#39;)</span>
        <span class="c1"># e point:</span>
        <span class="n">ind_e</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">aux_m2d_pks</span> <span class="o">&gt;</span> <span class="n">ind_m1d</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
        <span class="n">aux_m2d_pks</span> <span class="o">=</span> <span class="n">aux_m2d_pks</span><span class="p">[</span><span class="n">ind_e</span><span class="p">]</span>
        <span class="n">ind_e</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">aux_m2d_pks</span> <span class="o">&lt;</span> <span class="mf">0.6</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">ibi_2d_portion</span><span class="p">))</span>
        <span class="n">ind_e</span> <span class="o">=</span> <span class="n">aux_m2d_pks</span><span class="p">[</span><span class="n">ind_e</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind_e</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind_e</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">ind_e</span> <span class="o">=</span> <span class="n">ind_e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">e2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e2d</span><span class="p">,</span> <span class="n">ind_e</span> <span class="o">+</span> <span class="n">start</span><span class="p">)</span>
            <span class="c1">#plt.scatter(ind_e, ibi_2d_portion[ind_e]/np.max(ibi_2d_portion), marker = &#39;o&#39;)</span>
            <span class="c1"># c point:</span>
            <span class="n">ind_c</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">aux_m2d_pks</span> <span class="o">&lt;</span> <span class="n">ind_e</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind_c</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ind_c_aux</span> <span class="o">=</span> <span class="n">aux_m2d_pks</span><span class="p">[</span><span class="n">ind_c</span><span class="p">]</span>
                <span class="n">ind_c</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ibi_2d_portion</span><span class="p">[</span><span class="n">ind_c_aux</span><span class="p">]</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ibi_2d_portion</span><span class="p">[</span><span class="n">ind_c_aux</span><span class="p">]))</span>
                <span class="n">ind_c</span> <span class="o">=</span> <span class="n">ind_c_aux</span><span class="p">[</span><span class="n">ind_c</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind_c</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">c2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c2d</span><span class="p">,</span> <span class="n">ind_c</span> <span class="o">+</span> <span class="n">start</span><span class="p">)</span>
                    <span class="c1">#plt.scatter(ind_c, ibi_2d_portion[ind_c]/np.max(ibi_2d_portion), marker = &#39;o&#39;)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aux_m1d_ons</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="o">-</span><span class="n">ibi_1d_portion</span><span class="p">)</span>
                <span class="n">ind_c</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">aux_m1d_ons</span> <span class="o">&lt;</span> <span class="n">ind_e</span><span class="p">)</span>
                <span class="n">ind_c_aux</span> <span class="o">=</span> <span class="n">aux_m1d_ons</span><span class="p">[</span><span class="n">ind_c</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind_c</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">ind_c</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ind_c_aux</span> <span class="o">&gt;</span> <span class="n">ind_b</span><span class="p">)</span>
                    <span class="n">ind_c</span> <span class="o">=</span> <span class="n">ind_c_aux</span><span class="p">[</span><span class="n">ind_c</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind_c</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">ind_c</span> <span class="o">=</span> <span class="n">ind_c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">c2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c2d</span><span class="p">,</span> <span class="n">ind_c</span> <span class="o">+</span> <span class="n">start</span><span class="p">)</span>
                    <span class="c1">#plt.scatter(ind_c, ibi_2d_portion[ind_c]/np.max(ibi_2d_portion), marker = &#39;o&#39;)</span>
            <span class="c1"># d point:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind_c</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ind_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">aux_m2d_ons</span> <span class="o">&lt;</span> <span class="n">ind_e</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">aux_m2d_ons</span> <span class="o">&gt;</span> <span class="n">ind_c</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind_d</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">ind_d_aux</span> <span class="o">=</span> <span class="n">aux_m2d_ons</span><span class="p">[</span><span class="n">ind_d</span><span class="p">]</span>
                    <span class="n">ind_d</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ibi_2d_portion</span><span class="p">[</span><span class="n">ind_d_aux</span><span class="p">]</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ibi_2d_portion</span><span class="p">[</span><span class="n">ind_d_aux</span><span class="p">]))</span>
                    <span class="n">ind_d</span> <span class="o">=</span> <span class="n">ind_d_aux</span><span class="p">[</span><span class="n">ind_d</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind_d</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">d2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d2d</span><span class="p">,</span> <span class="n">ind_d</span> <span class="o">+</span> <span class="n">start</span><span class="p">)</span>
                        <span class="c1">#plt.scatter(ind_d, ibi_2d_portion[ind_d]/np.max(ibi_2d_portion), marker = &#39;o&#39;)                </span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ind_d</span> <span class="o">=</span> <span class="n">ind_c</span>
                    <span class="n">d2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d2d</span><span class="p">,</span> <span class="n">ind_d</span> <span class="o">+</span> <span class="n">start</span><span class="p">)</span>
                    <span class="c1">#plt.scatter(ind_d, ibi_2d_portion[ind_d]/np.max(ibi_2d_portion), marker = &#39;o&#39;)</span>
    <span class="n">a2d</span> <span class="o">=</span> <span class="n">a2d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">b2d</span> <span class="o">=</span> <span class="n">b2d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">c2d</span> <span class="o">=</span> <span class="n">c2d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">d2d</span> <span class="o">=</span> <span class="n">d2d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">e2d</span> <span class="o">=</span> <span class="n">e2d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="c1">#plt.figure()</span>
    <span class="c1">#plt.plot(d2x, color = &#39;black&#39;)</span>
    <span class="c1">#plt.scatter(a2d, d2x[a2d], marker = &#39;o&#39;, color = &#39;red&#39;) </span>
    <span class="c1">#plt.scatter(b2d, d2x[b2d], marker = &#39;o&#39;, color = &#39;blue&#39;)</span>
    <span class="c1">#plt.scatter(c2d, d2x[c2d], marker = &#39;o&#39;, color = &#39;green&#39;)</span>
    <span class="c1">#plt.scatter(d2d, d2x[d2d], marker = &#39;o&#39;, color = &#39;orange&#39;)</span>
    <span class="c1">#plt.scatter(e2d, d2x[e2d], marker = &#39;o&#39;, color = &#39;purple&#39;)</span>
    
    <span class="c1"># Search in D3: P1 and P2 points</span>
    <span class="n">p1p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">p2p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ons</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">ons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">ons</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">ibi_portion</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="n">ibi_1d_portion</span> <span class="o">=</span> <span class="n">d1x</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="n">ibi_2d_portion</span> <span class="o">=</span> <span class="n">d2x</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="n">ibi_3d_portion</span> <span class="o">=</span> <span class="n">d3x</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="n">ind_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">b2d</span> <span class="o">&gt;</span> <span class="n">start</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">b2d</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">))</span>
        <span class="n">ind_b</span> <span class="o">=</span> <span class="n">b2d</span><span class="p">[</span><span class="n">ind_b</span><span class="p">]</span>
        <span class="n">ind_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c2d</span> <span class="o">&gt;</span> <span class="n">start</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c2d</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">))</span>
        <span class="n">ind_c</span> <span class="o">=</span> <span class="n">c2d</span><span class="p">[</span><span class="n">ind_c</span><span class="p">]</span>
        <span class="n">ind_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">d2d</span> <span class="o">&gt;</span> <span class="n">start</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">d2d</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">))</span>
        <span class="n">ind_d</span> <span class="o">=</span> <span class="n">d2d</span><span class="p">[</span><span class="n">ind_d</span><span class="p">]</span>
        <span class="n">ind_dic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dic</span> <span class="o">&gt;</span> <span class="n">start</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dic</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">))</span>
        <span class="n">ind_dic</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="n">ind_dic</span><span class="p">]</span>
        <span class="c1">#plt.figure()</span>
        <span class="c1">#plt.plot(ibi_portion/np.max(ibi_portion))</span>
        <span class="c1">#plt.plot(ibi_1d_portion/np.max(ibi_1d_portion))</span>
        <span class="c1">#plt.plot(ibi_2d_portion/np.max(ibi_2d_portion))</span>
        <span class="c1">#plt.plot(ibi_3d_portion/np.max(ibi_3d_portion))</span>
        <span class="c1">#plt.scatter(ind_b - start, ibi_3d_portion[ind_b - start]/np.max(ibi_3d_portion), marker = &#39;o&#39;)</span>
        <span class="c1">#plt.scatter(ind_c - start, ibi_3d_portion[ind_c - start]/np.max(ibi_3d_portion), marker = &#39;o&#39;)</span>
        <span class="c1">#plt.scatter(ind_d - start, ibi_3d_portion[ind_d - start]/np.max(ibi_3d_portion), marker = &#39;o&#39;)</span>
        <span class="c1">#plt.scatter(ind_dic - start, ibi_3d_portion[ind_dic - start]/np.max(ibi_3d_portion), marker = &#39;o&#39;)</span>
        <span class="n">aux_p3d_pks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">ibi_3d_portion</span><span class="p">)</span>
        <span class="n">aux_p3d_ons</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="o">-</span><span class="n">ibi_3d_portion</span><span class="p">)</span>
        <span class="c1"># P1:</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aux_p3d_pks</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind_b</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">ind_p1</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">aux_p3d_pks</span> <span class="o">&gt;</span> <span class="n">ind_b</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind_p1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ind_p1</span> <span class="o">=</span> <span class="n">aux_p3d_pks</span><span class="p">[</span><span class="n">ind_p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">p1p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p1p</span><span class="p">,</span> <span class="n">ind_p1</span> <span class="o">+</span> <span class="n">start</span><span class="p">)</span>
                <span class="c1">#plt.scatter(ind_p1, ibi_3d_portion[ind_p1]/np.max(ibi_3d_portion), marker = &#39;o&#39;)</span>
        <span class="c1"># P2:</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aux_p3d_ons</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind_c</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind_d</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ind_c</span> <span class="o">==</span> <span class="n">ind_d</span><span class="p">:</span>
                <span class="n">ind_p2</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">aux_p3d_ons</span> <span class="o">&gt;</span> <span class="n">ind_d</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
                <span class="n">ind_p2</span> <span class="o">=</span> <span class="n">aux_p3d_ons</span><span class="p">[</span><span class="n">ind_p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ind_p2</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">aux_p3d_ons</span> <span class="o">&lt;</span> <span class="n">ind_d</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
                <span class="n">ind_p2</span> <span class="o">=</span> <span class="n">aux_p3d_ons</span><span class="p">[</span><span class="n">ind_p2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind_dic</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">aux_x_pks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span><span class="n">ibi_portion</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ind_p2</span> <span class="o">&gt;</span> <span class="n">ind_dic</span> <span class="o">-</span> <span class="n">start</span><span class="p">:</span>
                    <span class="n">ind_between</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">aux_x_pks</span> <span class="o">&lt;</span> <span class="n">ind_p2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">aux_x_pks</span> <span class="o">&gt;</span> <span class="n">ind_dic</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ind_between</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">aux_x_pks</span> <span class="o">&gt;</span> <span class="n">ind_p2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">aux_x_pks</span> <span class="o">&lt;</span> <span class="n">ind_dic</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind_between</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">ind_p2</span> <span class="o">=</span> <span class="n">aux_x_pks</span><span class="p">[</span><span class="n">ind_between</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">p2p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p2p</span><span class="p">,</span> <span class="n">ind_p2</span> <span class="o">+</span> <span class="n">start</span><span class="p">)</span>
            <span class="c1">#plt.scatter(ind_p2, ibi_3d_portion[ind_p2]/np.max(ibi_3d_portion), marker = &#39;o&#39;)</span>
    <span class="n">p1p</span> <span class="o">=</span> <span class="n">p1p</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">p2p</span> <span class="o">=</span> <span class="n">p2p</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="c1">#plt.figure()</span>
    <span class="c1">#plt.plot(d3x, color = &#39;black&#39;)</span>
    <span class="c1">#plt.scatter(p1p, d3x[p1p], marker = &#39;o&#39;, color = &#39;green&#39;) </span>
    <span class="c1">#plt.scatter(p2p, d3x[p2p], marker = &#39;o&#39;, color = &#39;orange&#39;)</span>
    
    <span class="c1"># Added by PC: Magnitudes of second derivative points</span>
    <span class="n">bmag2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b2d</span><span class="p">))</span>
    <span class="n">cmag2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b2d</span><span class="p">))</span>
    <span class="n">dmag2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b2d</span><span class="p">))</span>
    <span class="n">emag2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b2d</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">beat_no</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">b2d</span><span class="p">)):</span>
        <span class="n">bmag2d</span><span class="p">[</span><span class="n">beat_no</span><span class="p">]</span> <span class="o">=</span> <span class="n">d2x</span><span class="p">[</span><span class="n">b2d</span><span class="p">[</span><span class="n">beat_no</span><span class="p">]]</span><span class="o">/</span><span class="n">d2x</span><span class="p">[</span><span class="n">a2d</span><span class="p">[</span><span class="n">beat_no</span><span class="p">]]</span>
        <span class="n">cmag2d</span><span class="p">[</span><span class="n">beat_no</span><span class="p">]</span> <span class="o">=</span> <span class="n">d2x</span><span class="p">[</span><span class="n">c2d</span><span class="p">[</span><span class="n">beat_no</span><span class="p">]]</span><span class="o">/</span><span class="n">d2x</span><span class="p">[</span><span class="n">a2d</span><span class="p">[</span><span class="n">beat_no</span><span class="p">]]</span>
        <span class="n">dmag2d</span><span class="p">[</span><span class="n">beat_no</span><span class="p">]</span> <span class="o">=</span> <span class="n">d2x</span><span class="p">[</span><span class="n">d2d</span><span class="p">[</span><span class="n">beat_no</span><span class="p">]]</span><span class="o">/</span><span class="n">d2x</span><span class="p">[</span><span class="n">a2d</span><span class="p">[</span><span class="n">beat_no</span><span class="p">]]</span>        
        <span class="n">emag2d</span><span class="p">[</span><span class="n">beat_no</span><span class="p">]</span> <span class="o">=</span> <span class="n">d2x</span><span class="p">[</span><span class="n">e2d</span><span class="p">[</span><span class="n">beat_no</span><span class="p">]]</span><span class="o">/</span><span class="n">d2x</span><span class="p">[</span><span class="n">a2d</span><span class="p">[</span><span class="n">beat_no</span><span class="p">]]</span>    
        
     <span class="c1"># Added by PC: Refine the list of fiducial points to only include those corresponding to beats for which a full set of points is available</span>
    <span class="n">off</span> <span class="o">=</span> <span class="n">ons</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">ons</span> <span class="o">=</span> <span class="n">ons</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">pks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ons</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">pks</span> <span class="o">=</span> <span class="n">pks</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">if</span> <span class="n">pks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">off</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">pks</span> <span class="o">=</span> <span class="n">pks</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="c1"># Visualise results</span>
    <span class="k">if</span> <span class="n">vis</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span><span class="n">ax3</span><span class="p">,</span><span class="n">ax4</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Fiducial points&#39;</span><span class="p">)</span> 

        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pks</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">pks</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;pks&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ons</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">ons</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;ons&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">off</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">off</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)],</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dia</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">dia</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;dia&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">dic</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;dic&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tip</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">tip</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;dic&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>

        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d1x</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">m1d</span><span class="p">,</span> <span class="n">d1x</span><span class="p">[</span><span class="n">m1d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;m1d&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;d1x&#39;</span><span class="p">)</span>

        <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d2x</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">a2d</span><span class="p">,</span> <span class="n">d2x</span><span class="p">[</span><span class="n">a2d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">b2d</span><span class="p">,</span> <span class="n">d2x</span><span class="p">[</span><span class="n">b2d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">c2d</span><span class="p">,</span> <span class="n">d2x</span><span class="p">[</span><span class="n">c2d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;c&#39;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">d2d</span><span class="p">,</span> <span class="n">d2x</span><span class="p">[</span><span class="n">d2d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;d&#39;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">e2d</span><span class="p">,</span> <span class="n">d2x</span><span class="p">[</span><span class="n">e2d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;d2x&#39;</span><span class="p">)</span>

        <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d3x</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">p1p</span><span class="p">,</span> <span class="n">d3x</span><span class="p">[</span><span class="n">p1p</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;p1&#39;</span><span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">p2p</span><span class="p">,</span> <span class="n">d3x</span><span class="p">[</span><span class="n">p2p</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;p2&#39;</span><span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;d3x&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
                            <span class="n">bottom</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> 
                            <span class="n">right</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> 
                            <span class="n">top</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> 
                            <span class="n">wspace</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span> 
                            <span class="n">hspace</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">)</span>
        
    <span class="c1"># Creation of dictionary</span>
    <span class="n">fidp</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pks&#39;</span><span class="p">:</span> <span class="n">pks</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
            <span class="s1">&#39;ons&#39;</span><span class="p">:</span> <span class="n">ons</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
            <span class="s1">&#39;off&#39;</span><span class="p">:</span> <span class="n">off</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>  <span class="c1"># Added by PC</span>
            <span class="s1">&#39;tip&#39;</span><span class="p">:</span> <span class="n">tip</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
            <span class="s1">&#39;dia&#39;</span><span class="p">:</span> <span class="n">dia</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
            <span class="s1">&#39;dic&#39;</span><span class="p">:</span> <span class="n">dic</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
            <span class="s1">&#39;m1d&#39;</span><span class="p">:</span> <span class="n">m1d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
            <span class="s1">&#39;a2d&#39;</span><span class="p">:</span> <span class="n">a2d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
            <span class="s1">&#39;b2d&#39;</span><span class="p">:</span> <span class="n">b2d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
            <span class="s1">&#39;c2d&#39;</span><span class="p">:</span> <span class="n">c2d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
            <span class="s1">&#39;d2d&#39;</span><span class="p">:</span> <span class="n">d2d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
            <span class="s1">&#39;e2d&#39;</span><span class="p">:</span> <span class="n">e2d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
            <span class="s1">&#39;bmag2d&#39;</span><span class="p">:</span> <span class="n">bmag2d</span><span class="p">,</span>
            <span class="s1">&#39;cmag2d&#39;</span><span class="p">:</span> <span class="n">cmag2d</span><span class="p">,</span>
            <span class="s1">&#39;dmag2d&#39;</span><span class="p">:</span> <span class="n">dmag2d</span><span class="p">,</span>
            <span class="s1">&#39;emag2d&#39;</span><span class="p">:</span> <span class="n">emag2d</span><span class="p">,</span>
            <span class="s1">&#39;p1p&#39;</span><span class="p">:</span> <span class="n">p1p</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
            <span class="s1">&#39;p2p&#39;</span><span class="p">:</span> <span class="n">p2p</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="p">}</span>
    
    <span class="k">return</span> <span class="n">fidp</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Identify and visualise fiducial points</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fidp</span> <span class="o">=</span> <span class="n">fiducial_points</span><span class="p">(</span><span class="n">ppg_filt</span><span class="p">,</span><span class="n">ibis</span><span class="p">,</span><span class="n">fs</span><span class="p">,</span><span class="n">vis</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="nn">Input In [12],</span> in <span class="ni">&lt;cell line: 1&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">fidp</span> <span class="o">=</span> <span class="n">fiducial_points</span><span class="p">(</span><span class="n">ppg_filt</span><span class="p">,</span><span class="n">ibis</span><span class="p">,</span><span class="n">fs</span><span class="p">,</span><span class="n">vis</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="nn">Input In [11],</span> in <span class="ni">fiducial_points</span><span class="nt">(x, pks, fs, vis)</span>
<span class="g g-Whitespace">     </span><span class="mi">67</span> <span class="n">start</span> <span class="o">=</span> <span class="n">ons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">68</span> <span class="n">stop</span> <span class="o">=</span> <span class="n">ons</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
<span class="ne">---&gt; </span><span class="mi">69</span> <span class="n">ind_pks</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pks</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pks</span> <span class="o">&gt;</span> <span class="n">start</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span> <span class="n">ind_pks</span> <span class="o">=</span> <span class="n">pks</span><span class="p">[</span><span class="n">ind_pks</span><span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span> <span class="n">ibi_portion</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ind_pks</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>

<span class="ne">ValueError</span>: not enough values to unpack (expected 1, got 0)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="calculate-pulse-wave-features">
<h2>Calculate pulse wave features<a class="headerlink" href="#calculate-pulse-wave-features" title="Permalink to this headline">¶</a></h2>
<p>We will now calculate pulse wave features from the amplitudes and timings of the fiducial points on each pulse wave</p>
<ul class="simple">
<li><p>Note how the data are stored in the variable <code class="docutils literal notranslate"><span class="pre">fidp</span></code>:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">fidp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;a2d&#39;: array([189, 271, 353, 433, 519]),
 &#39;b2d&#39;: array([200, 292, 363, 443, 528]),
 &#39;bmag2d&#39;: array([-1.07086351, -0.5696967 , -0.85134426, -0.63233677, -0.76560773]),
 &#39;c2d&#39;: array([208, 286, 372, 449, 535]),
 &#39;cmag2d&#39;: array([-0.22573998, -0.43480793, -0.33363513, -0.33525452, -0.2759608 ]),
 &#39;d2d&#39;: array([213, 292, 374, 453, 540]),
 &#39;dia&#39;: array([230, 310, 393, 471, 557]),
 &#39;dic&#39;: array([222, 302, 384, 462, 549]),
 &#39;dmag2d&#39;: array([-0.35968829, -0.5696967 , -0.34558544, -0.39701305, -0.46525541]),
 &#39;e2d&#39;: array([222, 302, 384, 462, 549]),
 &#39;emag2d&#39;: array([0.27544615, 0.24510258, 0.18867102, 0.23560275, 0.30114416]),
 &#39;m1d&#39;: array([195, 277, 358, 438, 524]),
 &#39;off&#39;: array([268, 347, 429, 514, 578]),
 &#39;ons&#39;: array([168, 268, 347, 429, 514]),
 &#39;p1p&#39;: array([204, 297, 367, 446, 532]),
 &#39;p2p&#39;: array([211, 292, 373, 454, 538]),
 &#39;pks&#39;: array([209, 292, 372, 454, 538]),
 &#39;tip&#39;: array([187, 272, 352, 433, 519])}
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fidp</span></code> is a dictionary consisting of several arrays (one per fiducial point), with each array containing the indices of that fiducial point for all of the pulse waves. For instance, we can inspect the indices of the dicrotic notches (<code class="docutils literal notranslate"><span class="pre">dic</span></code>) using:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Indices of dicrotic notches:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fidp</span><span class="p">[</span><span class="s2">&quot;dic&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Indices of dicrotic notches:
[222 302 384 462 549]
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>We’ll start off by calculating <span class="math notranslate nohighlight">\(\Delta\)</span>T, the time delay between systolic and diastolic peaks (<code class="docutils literal notranslate"><span class="pre">pks</span></code> and <code class="docutils literal notranslate"><span class="pre">dia</span></code>):</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">delta_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fidp</span><span class="p">[</span><span class="s2">&quot;dia&quot;</span><span class="p">]))</span>
<span class="k">for</span> <span class="n">beat_no</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fidp</span><span class="p">[</span><span class="s2">&quot;dia&quot;</span><span class="p">])):</span>
    <span class="n">delta_t</span><span class="p">[</span><span class="n">beat_no</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">fidp</span><span class="p">[</span><span class="s2">&quot;dia&quot;</span><span class="p">][</span><span class="n">beat_no</span><span class="p">]</span><span class="o">-</span><span class="n">fidp</span><span class="p">[</span><span class="s2">&quot;pks&quot;</span><span class="p">][</span><span class="n">beat_no</span><span class="p">])</span><span class="o">/</span><span class="n">fs</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Values of Delta T:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">delta_t</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Values of Delta T:
[0.168 0.144 0.168 0.136 0.152]
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Now we’ll calculate a second pulse wave feature, the aging index:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">agi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fidp</span><span class="p">[</span><span class="s2">&quot;dia&quot;</span><span class="p">]))</span>
<span class="k">for</span> <span class="n">beat_no</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fidp</span><span class="p">[</span><span class="s2">&quot;dia&quot;</span><span class="p">])):</span>
    <span class="n">agi</span><span class="p">[</span><span class="n">beat_no</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">fidp</span><span class="p">[</span><span class="s2">&quot;bmag2d&quot;</span><span class="p">][</span><span class="n">beat_no</span><span class="p">]</span><span class="o">-</span><span class="n">fidp</span><span class="p">[</span><span class="s2">&quot;cmag2d&quot;</span><span class="p">][</span><span class="n">beat_no</span><span class="p">]</span><span class="o">-</span><span class="n">fidp</span><span class="p">[</span><span class="s2">&quot;dmag2d&quot;</span><span class="p">][</span><span class="n">beat_no</span><span class="p">]</span><span class="o">-</span><span class="n">fidp</span><span class="p">[</span><span class="s2">&quot;emag2d&quot;</span><span class="p">][</span><span class="n">beat_no</span><span class="p">])</span><span class="o">/</span><span class="n">fs</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Values of Aging Index:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">agi</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Values of Aging Index:
[-0.00608705  0.00151764 -0.00288636 -0.00108538 -0.00260429]
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./tutorial/notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="beat-detection.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Beat detection</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="extracting-reference-bp.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Extracting BP values</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Peter H Charlton<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>